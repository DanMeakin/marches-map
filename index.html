<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:v="urn:schemas-microsoft-com:vml"> 
<head>
  <title>The Freedom Lands of Aberdeen</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
  <meta http-equiv='imagetoolbar' content='no'/>

  <link href='https://fonts.googleapis.com/css?family=Neuton:400,400italic,700,800,300,200' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Arapey:400,400italic' rel='stylesheet' type='text/css'>

  <!-- Latest compiled and minified CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">

  <!-- Optional theme -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap-theme.min.css" integrity="sha384-fLW2N01lMqjakBkx3l/M9EahuwpSfeNvV63J5ezn3uZzapT0u7EYsXMjQV+0En5r" crossorigin="anonymous">

  <!-- Custom Styles -->
  <link rel="stylesheet" href="style.css">

  <!-- Latest compiled and minified JavaScript -->
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
  <script src='http://maps.google.com/maps?file=api&amp;v=2&amp;key=AIzaSyDf78DD45O6mlSyTexVPKS1CI4voWFMb2w'></script>
  <script>
var mapBounds = new GLatLngBounds(new GLatLng(57.1087510764, -2.29091103907), new GLatLng(57.1981551564, -2.05257611505));
var mapMinZoom = 1;
var mapMaxZoom = 16;

var opacity = 0.75;
var map;
var hybridOverlay;

/*
 * Create a Custom Opacity GControl
 * http://www.maptiler.org/google-maps-overlay-opacity-control/
 */

var CTransparencyLENGTH = 58; 
// maximum width that the knob can move (slide width minus knob width)

function CTransparencyControl( overlay ) {
    this.overlay = overlay;
    this.opacity = overlay.getTileLayer().getOpacity();
}
CTransparencyControl.prototype = new GControl();

// This function positions the slider to match the specified opacity
CTransparencyControl.prototype.setSlider = function(pos) {
    var left = Math.round((CTransparencyLENGTH*pos));
    this.slide.left = left;
    this.knob.style.left = left+"px";
    this.knob.style.top = "0px";
}

// This function reads the slider and sets the overlay opacity level
CTransparencyControl.prototype.setOpacity = function() {
    // set the global variable
    opacity = this.slide.left/CTransparencyLENGTH;
    this.map.clearOverlays();
    this.map.addOverlay(this.overlay, { zPriority: 0 });
    if (this.map.getCurrentMapType() == G_HYBRID_MAP) {
        this.map.addOverlay(hybridOverlay);
    }
}

// This gets called by the API when addControl(new CTransparencyControl())
CTransparencyControl.prototype.initialize = function(map) {
    var that=this;
    this.map = map;

    // Is this MSIE, if so we need to use AlphaImageLoader
    var agent = navigator.userAgent.toLowerCase();
    if ((agent.indexOf("msie") > -1) && (agent.indexOf("opera") < 1)){this.ie = true} else {this.ie = false}

    // create the background graphic as a <div> containing an image
    var container = document.createElement("div");
    container.style.width="70px";
    container.style.height="21px";

    // Handle transparent PNG files in MSIE
    if (this.ie) {
      var loader = "filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(src='http://www.maptiler.org/img/opacity-slider.png', sizingMethod='crop');";
      container.innerHTML = '<div style="height:21px; width:70px; ' +loader+ '" ></div>';
    } else {
      container.innerHTML = '<div style="height:21px; width:70px; background-image: url(http://www.maptiler.org/img/opacity-slider.png)" ></div>';
    }

    // create the knob as a GDraggableObject
    // Handle transparent PNG files in MSIE
    if (this.ie) {
      var loader = "progid:DXImageTransform.Microsoft.AlphaImageLoader(src='http://www.maptiler.org/img/opacity-slider.png', sizingMethod='crop');";
      this.knob = document.createElement("div"); 
      this.knob.style.height="21px";
      this.knob.style.width="13px";
  this.knob.style.overflow="hidden";
      this.knob_img = document.createElement("div"); 
      this.knob_img.style.height="21px";
      this.knob_img.style.width="83px";
      this.knob_img.style.filter=loader;
  this.knob_img.style.position="relative";
  this.knob_img.style.left="-70px";
      this.knob.appendChild(this.knob_img);
    } else {
      this.knob = document.createElement("div"); 
      this.knob.style.height="21px";
      this.knob.style.width="13px";
      this.knob.style.backgroundImage="url(http://www.maptiler.org/img/opacity-slider.png)";
      this.knob.style.backgroundPosition="-70px 0px";
    }
    container.appendChild(this.knob);
    this.slide=new GDraggableObject(this.knob, {container:container});
    this.slide.setDraggableCursor('pointer');
    this.slide.setDraggingCursor('pointer');
    this.container = container;

    // attach the control to the map
    map.getContainer().appendChild(container);

    // init slider
    this.setSlider(this.opacity);

    // Listen for the slider being moved and set the opacity
    GEvent.addListener(this.slide, "dragend", function() {that.setOpacity()});
    //GEvent.addListener(this.container, "click", function( x, y ) { alert(x, y) });

    return container;
  }

  // Set the default position for the control
  CTransparencyControl.prototype.getDefaultPosition = function() {
    return new GControlPosition(G_ANCHOR_TOP_RIGHT, new GSize(7, 47));
  }

/*
 * Full-screen Window Resize
 */

function getWindowHeight() {
    if (self.innerHeight) return self.innerHeight;
    if (document.documentElement && document.documentElement.clientHeight)
        return document.documentElement.clientHeight;
    if (document.body) return document.body.clientHeight;
    return 0;
}

function getWindowWidth() {
    if (self.innerWidth) return self.innerWidth;
    if (document.documentElement && document.documentElement.clientWidth)
        return document.documentElement.clientWidth;
    if (document.body) return document.body.clientWidth;
    return 0;
}

function resize() {
    var map = document.getElementById("map");  
    var header = document.getElementById("header");  
    var subheader = document.getElementById("subheader");  
    var mapWidth = getWindowWidth() - 20;
    var mapHeight = mapWidth / 2;//* 4/3;
    map.style.width = mapWidth + "px";
    map.style.height = mapHeight + "px";
    // map.checkResize();
}


/*
 * Main load function:
 */

function load() {

   if (GBrowserIsCompatible()) {

      // Bug in the Google Maps: Copyright for Overlay is not correctly displayed
      var gcr = GMapType.prototype.getCopyrights;
      GMapType.prototype.getCopyrights = function(bounds,zoom) {
          return [""].concat(gcr.call(this,bounds,zoom));
      }

      map = new GMap2( document.getElementById("map"), { backgroundColor: '#fff' } );

      map.addMapType(G_PHYSICAL_MAP);
      map.setMapType(G_PHYSICAL_MAP);

      map.setCenter( mapBounds.getCenter(), map.getBoundsZoomLevel( mapBounds ));

      hybridOverlay = new GTileLayerOverlay( G_HYBRID_MAP.getTileLayers()[1] );
      GEvent.addListener(map, "maptypechanged", function() {
        if (map.getCurrentMapType() == G_HYBRID_MAP) {
            map.addOverlay(hybridOverlay);
        } else {
           map.removeOverlay(hybridOverlay);
        }
      } );

      var tilelayer = new GTileLayer(GCopyrightCollection(''), mapMinZoom, mapMaxZoom);
      var mercator = new GMercatorProjection(mapMaxZoom+1);
      tilelayer.getTileUrl = function(tile,zoom) {
          if ((zoom < mapMinZoom) || (zoom > mapMaxZoom)) {
              return "http://www.maptiler.org/img/none.png";
          }
          var ymax = 1 << zoom;
          var y = ymax - tile.y -1;
          var tileBounds = new GLatLngBounds(
              mercator.fromPixelToLatLng( new GPoint( (tile.x)*256, (tile.y+1)*256 ) , zoom ),
              mercator.fromPixelToLatLng( new GPoint( (tile.x+1)*256, (tile.y)*256 ) , zoom )
          );
          if (mapBounds.intersects(tileBounds)) {
              return zoom+"/"+tile.x+"/"+y+".png";
          } else {
              return "http://www.maptiler.org/img/none.png";
          }
      }
      // IE 7-: support for PNG alpha channel
      // Unfortunately, the opacity for whole overlay is then not changeable, either or...
      tilelayer.isPng = function() { return true;};
      tilelayer.getOpacity = function() { return opacity; }

      overlay = new GTileLayerOverlay( tilelayer );
      map.addOverlay(overlay);

      map.addControl(new GLargeMapControl());
      map.addControl(new GHierarchicalMapTypeControl());
      map.addControl(new CTransparencyControl( overlay ));


      map.enableContinuousZoom();
      map.enableScrollWheelZoom();

      map.setMapType(G_HYBRID_MAP);
   }
   resize();
}

onresize=function(){ resize(); };
</script>
</head>
<body onload="load()">
  <div class="container">
    <div class="row">
        <h1>The Freedom Lands of Aberdeen</h1>
    </div>
    <div class="row">
      <div class="col-xs-offset-2 col-xs-4 coats-of-arms">
        <img class="coat-of-arms" src="burgesses-coat-of-arms.png">
      </div>
      <div class="col-xs-4 coats-of-arms">
        <img class="coat-of-arms" src="acc-coat-of-arms.png">
      </div>
    </div>
  <h2>The Freedom Lands</h2>
  <p>
  In 1319, when the Kingdom of Scotland was passing through a period of
  depression and the victorious King Robert the Bruce felt he had an honourable
  duty to perform to those who helped him establish the independence of the
  Kingdom, a regular feudal Charter of the burgh of Aberdeen and of the Stocket
  forest was granted the burgesses. The Forest of the Stocket, together with
  certain additional areas, comprises what is known as "The Freedom Lands".
  </p>

  <h2>The Marches</h2>
  <p>
  The observance of boundaries or marches and the preservation of landmarks
  are of remote origin, and go back to the time when man took one of his early
  steps along the path of civilization. At first, no doubt, the landmarks were
  natural objects, such as hills, trees and streams, and the rough tracks or
  highways of the time, but as early society grew in complexity, the necessity
  for marks of artificial construction arose, and with these came the collateral
  necessity of guarding against their removal. A riding of the Marches at 
  frequent intervals was undertaken for the purpose of ensuring that the 
  landmarks were not moved, or if moved, that they were restored to their 
  original position.
  </p> 
  <p>
  The interactive map below shows the extent of The Freedom Lands and the
  Inner and Outer Marches, the boundaries of the lands. You can view the 
  historical extend of the lands, and in many cases, using Google Street View,
  you can see the stones themselves.
  </p>
  </div>
  <div id="map"></div>
  <div class="container">
    <div class="row">
      <h2>
        Maps
      </h2>
      <p>
      A number of maps of the March Stones have been created over the years.
      In addition to the interactive map created for this site, maps from 1929
      and 1977 can be viewed by clicking the thumbnails, below.
      </p>
    </div>
    <div class="row">
      <div class="col-xs-offset-1 col-xs-5 maps">
        <a href="map-1977-lg.png">
          <img class="map" src="map-1977-sm.png">
        </a>
      </div>
      <div class="col-xs-5 maps">
        <a href="map-1929-lg.jpg">
          <img class="map" src="map-1929-sm.png">
        </a>
      </div>
    </div>
    <div class="row">
      <h2>
        About Us
      </h2>
      <p>
      This site has been created by The Burgesses of Guild of the Royal Burgh and 
      City of Aberdeen, with the support of the Aberdeen City Council, to provide
      a resource to those interested in The Freedom Lands and the March Stones.
      </p>
      <p>
      Information about the stones, and images of the March Stones will be added to 
      the above map in the near future.
      </p>
    </div>
    <div id="footer" class="row">
      <hr />
      <div id="contact">
      Contact:
      <a href="mailto:marchstone1319@yahoo.co.uk">General Inquiries</a>
      &bull;
      <a href="mailto:BHarrison@sportaberdeen.co.uk">Access Inquiries</a>
      </div>
      Copyright &copy; 2016 Burgesses of Guild of the Royal Burgh and City of Aberdeen.
      <br />
      Images and historical information courtesy of Aberdeen City Council.
  </div>
</body>
</html>

